<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>HS Nutrition | Store</title>
<link href="https://fonts.googleapis.com" rel="preconnect"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet"/>
<meta content="no-store" http-equiv="Cache-Control"/>
<style>
:root{ --black:#0d0d0d; --white:#ffffff; --muted:#9c9c9c; --orange:#ff3c00; --card:#1a1a1a; --oos:#ff2d2d; }
*{box-sizing:border-box}
body{ margin:0; font-family:Poppins,system-ui,Arial,sans-serif; color:var(--white); background:var(--black); min-height:100dvh; }
.wrap{max-width:1200px;margin:0 auto;padding:26px}
.card{ background:transparent; border:none; border-radius:0; padding:0; box-shadow:none; position:relative; }
header{text-align:center;margin-bottom:18px; position: relative;}
.brand{ display:flex; flex-direction:column; align-items:center; gap:0; position:relative; }
.brand img{ max-width:100%; height:auto; border:2px solid var(--orange); border-radius:20px; animation: glow 3s ease-in-out infinite alternate; }
@keyframes glow { from { box-shadow:0 0 6px rgba(255,60,0,0.3); } to { box-shadow:0 0 14px rgba(255,100,0,0.6); } }
.welcome { width: 100%; max-width: 550px; margin: 10px 0 0 0; }
.welcome text { font-family: "Poppins", cursive; font-size: 64px; fill: none; stroke: var(--orange); stroke-width: 2px; stroke-dasharray: 800; stroke-dashoffset: 800; animation: draw 6s ease forwards; }
@keyframes draw { to { stroke-dashoffset: 0; } }
.brand .search-box { position: absolute; bottom: 10px; right: 20px; max-width: 300px; display: flex; gap: 6px; }
.search-box input { flex: 1; padding: 12px 16px; border-radius: 20px; border: 1px solid #ddd; outline: none; background: #ffffff; color: #000000; font-size: 14px; }
.search-box input::placeholder { color: #555; }
.search-box button { padding: 12px 20px; border: 1px solid #ddd; border-radius: 20px; background: #ffffff; color: #000000; font-weight: 700; cursor: pointer; }
.search-box button:hover { filter: none; opacity: .9; }
.divider{height:2px;background:linear-gradient(90deg,transparent,var(--orange),transparent);margin:18px 0}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:22px;align-items:stretch}
@media (max-width:600px){
  .grid{grid-template-columns:repeat(2,1fr)}
  .brand { align-items: center; }
  .brand .search-box { position: static; margin-top: 14px; width: 100%; max-width: 100%; padding: 0 10px; display: flex; justify-content: center; gap: 8px; }
}

/* ===== Products ===== */
.product{display:flex;flex-direction:column;justify-content:space-between;}
.product{background:#111;border:1px solid rgba(255,255,255,.08);border-radius:18px;overflow:hidden;box-shadow:0 10px 28px rgba(0,0,0,.28);display:flex;flex-direction:column; position:relative;}
.product img{width:100%;aspect-ratio:1/1;object-fit:cover;background:#0b0b0b;display:block;cursor:pointer;}
.product-body{padding:14px 16px 10px}
.product h3{margin:0 0 6px;font-weight:700;font-size:16px;color:var(--white); cursor:pointer; }
.meta{color:var(--muted);font-size:13px;line-height:1.4;margin-bottom:8px}
.price{font-weight:700;color:var(--white);margin-bottom:6px}
.cta{padding:12px 14px 14px;border-top:1px dashed rgba(255,255,255,.08)}
.btn{display:block;width:100%;text-align:center;text-decoration:none;font-weight:700;padding:12px 14px;border-radius:28px;background:linear-gradient(90deg,var(--orange), #ff8c42);color:#fff;box-shadow:0 8px 20px rgba(240,116,36,.35);transition:transform .18s ease, filter .18s ease;}
.btn:hover{transform:translateY(-1px);filter:brightness(1.1)}
.btn.disabled{opacity:.55;pointer-events:none;filter:grayscale(1)}
footer{color:var(--muted);text-align:center;font-size:12px;margin-top:20px}
.admin-btn-modal { position: absolute; top: 12px; right: 12px; z-index: 100; }
.admin-btn-modal a { background: var(--orange); color: var(--white); text-decoration: none; padding: 4px 8px; border-radius: 6px; font-weight: 500; font-size: 11px; box-shadow: 0 1px 4px rgba(0,0,0,0.4); transition: filter 0.2s; display: inline-block; }
.admin-btn-modal a:hover { filter: brightness(1.1); }
.oos-ribbon{ position:absolute; top:10px; left:-40px; transform: rotate(-20deg); background: rgba(255,45,45,0.85); color:#fff; padding:10px 60px; font-weight:900; letter-spacing:.12em; text-shadow: 0 1px 2px rgba(0,0,0,.35); box-shadow:0 10px 20px rgba(0,0,0,.35); border:2px solid rgba(255,255,255,0.12); pointer-events:none; }

/* ===== Floating cart ===== */
.floating-cart {
  position: fixed;
  bottom: 20px;
  right: 20px;
  background: var(--orange);
  color: white;
  border-radius: 50%;
  width: 70px;
  height: 70px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 2px;
  box-shadow: 0 6px 18px rgba(0,0,0,0.35);
  cursor: pointer;
  z-index: 5000;
  transition: transform 0.3s ease;
}
/* quando o menu estiver aberto, o carrinho fica por trÃ¡s */
.menu-open .floating-cart{
  z-index: 2000;
  pointer-events: none;
}
.floating-cart .cart-ico { font-size: 28px; line-height: 1; }
.floating-cart .cart-count { font-size: 14px; font-weight: 800; line-height: 1; }
.floating-cart .cart-count:empty { display:none; }
.floating-cart:hover { transform: scale(1.1) rotate(5deg); }

/* ========= GENERIC MODAL ========= */
.modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.85); justify-content:center; align-items:center; z-index: 6000; }
.modal-content { background:var(--card); padding:20px; border-radius:16px; max-width:600px; width:90%; text-align:left; color:var(--white); position:relative; border: 1px solid rgba(255,255,255,0.12); }
.modal-close{position:absolute;top:10px;right:10px;background:#ff3c00;border:none;color:#fff;font-weight:bold;padding:6px 12px;border-radius:6px;cursor:pointer}

.cart-content { background:#ffffff; color:#111; border:2px solid var(--orange); box-shadow:0 18px 42px rgba(0,0,0,.45); }
.cart-content h2 { color:#111; margin:0 0 6px; }
.cart-divider { border:none; border-top:2px dashed rgba(0,0,0,0.08); }
.cart-total { display:flex; justify-content:space-between; align-items:center; margin-bottom:12px; font-weight:800; color:#111; }
.cart-checkout { width:100%; background:linear-gradient(90deg,var(--orange), #ff8c42) !important; color:#fff; border:none; }
.cart-item { display:flex; align-items:center; justify-content:space-between; gap:10px; margin-bottom:10px; }
.cart-item-left { display:flex; align-items:center; gap:10px; }
.cart-thumb { width:46px; height:46px; border-radius:8px; object-fit:cover; border:1px solid rgba(0,0,0,.06); }
.cart-qty { display:flex; align-items:center; gap:6px; }

/* ====== HAMBURGER MENU ====== */
.menu-toggle {
  position: relative;
  z-index: 1000;
  display: inline-flex;
  align-items: center;
  gap: 10px;
  padding: 10px 14px;
  border-radius: 9999px;
  background: var(--orange);
  color: var(--white);
  font-weight: 900;
  border: 2px solid var(--orange);
  cursor: pointer;
  user-select: none;
  box-shadow: 0 6px 18px rgba(255,60,0,0.35);
}
.menu-toggle .bars{ width: 18px; height: 12px; position: relative; }
.menu-toggle .bars::before,
.menu-toggle .bars::after,
.menu-toggle .bar{
  content: ""; position: absolute; left: 0; right: 0; height: 2px; background: #fff; border-radius: 2px;
}
.menu-toggle .bar{ top: 5px; }
.menu-toggle .bars::before{ top: 0; }
.menu-toggle .bars::after{ bottom: 0; }

/* Drawer */
.drawer-overlay{
  position: fixed; inset: 0; background: rgba(0,0,0,0.6);
  opacity: 0; pointer-events: none; transition: opacity .28s ease;
  z-index: 2500;
}
.drawer-overlay.show{ opacity: 1; pointer-events:auto;}
.drawer{
  position: fixed; top: 0; left: 0; height: 100%; width: min(92vw, 380px);
  background: #0f0f0f; color: #fff; transform: translateX(-100%);
  transition: transform .28s ease; z-index: 2600; border-right: 1px solid rgba(255,255,255,0.08);
  box-shadow: 0 20px 40px rgba(0,0,0,.5);
}
/* largura do menu 70% em mobile */
@media (max-width:600px){
  .drawer{ width: 70vw; }
}
.drawer.open{ transform: translateX(0); }
.drawer-header{ padding: 18px 18px 10px; display:flex; align-items:center; justify-content:space-between; border-bottom:1px solid rgba(255,255,255,0.08); }
.drawer-title{ font-weight: 900; letter-spacing: .06em; color: var(--orange); }
.drawer-close{ background: transparent; color: #fff; border:none; font-size: 26px; cursor:pointer; }
.drawer-body{ padding: 12px 18px 24px; overflow:auto; height: calc(100% - 60px); scrollbar-width:none; -ms-overflow-style:none; }
.drawer-body::-webkit-scrollbar{ display:none; }
.section{ margin: 10px 0 18px; }
/* TITULOS "SUPPLEMENTS" e "COSMETICS" em laranja */
.section h4{ margin: 10px 0 8px; color: var(--orange); font-size: 14px; letter-spacing: .08em; text-transform: uppercase; opacity:1 }
.section ul{ list-style: none; padding: 0; margin: 0; display: grid; gap: 8px; }
.section a{
  display:block; padding: 10px 12px; border-radius: 10px; background: #151515;
  color: #fff; text-decoration: none; border: 1px solid rgba(255,255,255,0.06);
}
.section a:hover{ background:#191919; }
.drawer-footer{ padding: 14px 18px; border-top:1px dashed rgba(255,255,255,0.08); color:#9c9c9c; font-size: 12px; }

/* ===== Product Detail Modal ===== */
.product-content{ max-width:760px; width:min(92vw,760px); }
.product-modal-body{ display:grid; grid-template-columns: 1fr; gap: 14px; }
#pmImage{ width:100%; max-height:340px; border-radius:12px; object-fit:contain; background:#0b0b0b; }
.product-title{ margin:0 0 4px; font-size: 20px; font-weight: 900; }
.product-brand{ color: var(--muted); margin: 0 0 8px; }
.product-price{ font-weight: 900; margin: 6px 0; }
.product-stock{ color: var(--muted); font-size: 12px; margin-bottom: 10px; }
.product-desc{ color: #e9e9e9; font-size: 14px; line-height: 1.5; }
.gallery{ display:flex; gap:8px; margin-top:10px; overflow-x:auto; padding-bottom:4px; }
.gallery img{ width:70px; height:70px; object-fit:cover; border-radius:10px; cursor:pointer; border:1px solid rgba(255,255,255,.08); flex:0 0 auto; }
@media (min-width: 760px){
  .product-modal-body{ grid-template-columns: 1.2fr 1fr; align-items:start; }
}

/* Enlarged Menu button */
.big-menu-btn {
  font-size: 1.125rem; /* ~18px */
  padding: 0.9rem 1.2rem;
  border-radius: 9999px;
}
@media (min-width: 768px) {
  .big-menu-btn {
    font-size: 1.25rem; /* ~20px */
    padding: 1rem 1.4rem;
  }
}

/* ===== New Drawer Menu (4 options; first two expandable) ===== */
.menu { margin-top: 6px; }
.menu-list { list-style: none; padding: 0; margin: 0; display: grid; gap: 10px; }
.menu-item { display: grid; grid-template-columns: 1fr auto; align-items: center; background: #151515; border:1px solid rgba(255,255,255,0.08); border-radius:12px; }
.menu-link { display: block; padding: 12px 14px; text-decoration: none; color: #fff; }
.menu-link.primary { color: var(--orange); font-weight: 900; letter-spacing: .05em; text-transform: none; }
.submenu-toggle { margin-right: 6px; margin-left: 4px; background: transparent; border: none; color: var(--orange); font-size: 20px; line-height: 1; cursor: pointer; padding: 10px; transform: rotate(0deg); transition: transform .2s ease; }
.submenu[hidden]{display:none !important;}

.submenu-toggle[aria-expanded="true"] { transform: rotate(90deg); } /* rotate caret when open */
.submenu { grid-column: 1 / -1; list-style: none; padding: 8px 10px 12px; margin: 0; display: grid; gap: 8px; }
.submenu a { display:block; padding:10px 12px; background:#101010; border-radius:10px; border:1px solid rgba(255,255,255,.06); color:#fff; text-decoration:none; }
.submenu a:hover { background:#191919; }


/* ===== Custom edits: Menu top-left like Admin; typewriter phrase ===== */
.menu-btn-modal { position: absolute; top: 12px; left: 12px; z-index: 100; }
.menu-btn-modal .menu-toggle {
  background: var(--orange);
  color: var(--white);
  font-weight: 700;
  text-decoration: none;
  padding: 4px 8px;
  border-radius: 6px;
  border: none;
  cursor: pointer;
  box-shadow: 0 3px 8px rgba(0,0,0,0.4);
  transition: filter 0.2s;
  display: inline-block;
  align-items: center;
  gap: 8px;
}
.menu-btn-modal .menu-toggle:hover { filter: brightness(1.1); }
.menu-btn-modal .menu-toggle .bars { display: none; }

/* Phrase in place of the old centered Menu button, with a typewriter effect */
.menu-phrase {
  text-align: center;
  margin: 8px 0 6px;
  font-family: 'Orbitron', Poppins, system-ui, Arial, sans-serif;
  font-weight: 700;
  letter-spacing: 0.5px;
  font-size: clamp(20px, 4vw, 32px);
  white-space: nowrap;
  overflow: hidden;
  border-right: 2px solid var(--orange);
  width: 0;
  display: inline-block;
  animation: typing 3s steps(24, end) forwards, caret-blink 0.8s step-end infinite;
}
@keyframes typing { from { width: 0 } to { width: 23ch } } /* "Your only limit is you" => 23ch */
@keyframes caret-blink { 50% { border-color: transparent; } }


/* Ensure Admin and Menu buttons are identical in size and shape */
.admin-btn-modal a, .menu-btn-modal .menu-toggle {
  padding: 6px 10px; /* unified size */
  border-radius: 6px;
  font-size: 13px;
  line-height: 1.1;
  display: inline-block;
}


.menu-btn-modal .menu-toggle { align-items: unset; gap: 0; }


/* === Force Admin and Menu to be IDENTICAL (size & format) === */
.admin-btn-modal a, .menu-btn-modal .menu-toggle {
  padding: 4px 8px;
  border-radius: 6px;
  font-size: 11px;
  font-weight: 500;
  line-height: 1;
  width: 72px;              /* fixed width so both pills look iguais */
  text-align: center;
  box-shadow: 0 1px 4px rgba(0,0,0,0.4);
  border: none;
  display: inline-block;
}
/* Make sure menu button ignores any previous border from generic .menu-toggle */
.menu-btn-modal .menu-toggle {
  border: none !important;
  box-shadow: 0 1px 4px rgba(0,0,0,0.4) !important;
}


/* Reduce the WELCOME heading to half size */
.welcome text:first-of-type { font-size: 32px !important; }

</style>
</head>
<body>

<!-- DRAWER + OVERLAY -->
<div class="drawer-overlay" id="drawerOverlay"></div>
<aside class="drawer" id="sideMenu" aria-hidden="true">
  <div class="drawer-header">
    <div class="drawer-title">Browse</div>
    <button class="drawer-close big-menu-btn" id="closeMenu" aria-label="Close menu">Ã—</button>
  </div>
  
  <div class="drawer-body">
    <nav class="menu">
      <ul class="menu-list">
        <!-- Suplementes (expandable + links to general page) -->
        <li class="menu-item">
          <a class="menu-link primary" href="supplements.html">Supplements</a>
          <button type="button" class="submenu-toggle" aria-expanded="false" aria-controls="submenu-supplements">â€º</button>
          <ul id="submenu-supplements" class="submenu" hidden>
            <li><a href="vitamins-and-minerals.html">Vitamins &amp; Minerals</a></li>
            <li><a href="heart-health.html">Heart Health</a></li>
            <li><a href="liver-support.html">Liver Support</a></li>
            <li><a href="multivitamins.html">Multivitamins</a></li>
            <li><a href="mass-gainer.html">Mass Gainer</a></li>
            <li><a href="pre-workout.html">Pre-Workout</a></li>
            <li><a href="bcaa-and-eaa.html">BCAA &amp; EAA</a></li>
            <li><a href="probiotics.html">Probiotics</a></li>
            <li><a href="glutamine.html">Glutamine</a></li>
            <li><a href="collagen.html">Collagen</a></li>
            <li><a href="diuretics.html">Diuretics</a></li>
            <li><a href="omega-3.html">Omega 3</a></li>
            <li><a href="creatine.html">Creatine</a></li>
            <li><a href="fat-loss.html">Fat Loss</a></li>
          </ul>
        </li>

        <!-- Cosmetics (expandable + links to general page) -->
        <li class="menu-item">
          <a class="menu-link primary" href="cosmetics.html">Cosmetics</a>
          <button type="button" class="submenu-toggle" aria-expanded="false" aria-controls="submenu-cosmetics">â€º</button>
          <ul id="submenu-cosmetics" class="submenu" hidden>
            <li><a href="body-oil.html">Body Oil</a></li>
            <li><a href="nails.html">Nails</a></li>
            <li><a href="perfume.html">Perfume</a></li>
            <li><a href="mascara.html">Mascara</a></li>
            <li><a href="skin-care.html">Skin Care</a></li>
            <li><a href="soap.html">Soap</a></li>
            <li><a href="moisturizer.html">Moisturizer</a></li>
            <li><a href="body-splash.html">Body Splash</a></li>
            <li><a href="hair-tonic.html">Hair Tonic</a></li>
            <li><a href="leavein-cream.html">Leaveâ€‘in Cream</a></li>
            <li><a href="shampoo-and-conditioner.html">Shampoo &amp; Conditioner</a></li>
          </ul>
        </li>

        <!-- Clothes (simple link, orange) -->
        <li class="menu-item">
          <a class="menu-link primary" href="clothes.html">Clothes</a>
        </li>

        <!-- Contactos (simple link, orange) -->
        <li class="menu-item">
          <a class="menu-link primary" href="contactos.html">Contacts</a>
        </li>
      </ul>
    </nav>
  </div>

  <div class="drawer-footer">Tap a category to open.</div>
</aside>

<div class="wrap">
  <div class="card">
    <div class="menu-btn-modal"><button class="menu-toggle" id="openMenu" aria-controls="sideMenu" aria-expanded="false"><span class="bars"><span class="bar"></span></span>Menu</button></div>
    <div class="admin-btn-modal"><a href="login.html">Admin</a></div>

    <header>
      <div class="brand">
        <svg class="welcome" viewBox="0 0 600 140" xmlns="http://www.w3.org/2000/svg">
          <text text-anchor="middle" x="50%" y="50%">WELCOME</text>
          <text text-anchor="middle" x="50%" y="72%" style="font-family: Poppins, sans-serif; font-size: 18px; fill: var(--orange); stroke: none;">www.hs-nutrition.ie</text>
        </svg>
        <img alt="HS Nutrition Cover" src="5.png"/>
        <div class="search-box">
          <input id="search" placeholder="Search for products..." type="text"/>
          <button onclick="searchProducts()">Search</button>
        </div>
      </div>
    </header>

    <!-- Menu button (replaced by phrase) -->
    <div class="menu-row" style="display:flex;justify-content:center;gap:12px;margin:8px 0 6px;">
      <div class="menu-phrase" aria-label="Your only limit is you">Your only limit is you</div>
    </div>

    <div class="divider"></div>
    <section class="grid" id="products"></section>
    <div class="divider"></div>

    <footer>Â© <span id="year"></span> HS Nutrition</footer>
  </div>
</div>

<!-- Floating Cart -->
<div class="floating-cart" onclick="openCart()" aria-label="Open cart">
  <div class="cart-ico">ðŸ›’</div>
  <div class="cart-count" id="cartCount"></div>
</div>

<!-- Product Detail Modal -->
<div id="productModal" class="modal" aria-hidden="true">
  <div class="modal-content product-content">
    <button class="modal-close" onclick="closeProductModal()">Ã—</button>
    <div class="product-modal-body">
      <div>
        <img id="pmImage" alt="Product image"/>
        <div class="gallery" id="pmGallery"></div>
      </div>
      <div>
        <h3 class="product-title" id="pmTitle"></h3>
        <div class="product-brand" id="pmBrand"></div>
        <div class="product-price" id="pmPrice"></div>
        <div class="product-stock" id="pmStock"></div>
        <p class="product-desc" id="pmDesc"></p>
        <div id="pmCta" style="margin-top:12px;"></div>
      </div>
    </div>
  </div>
</div>

<!-- Cart Modal -->
<div id="cartModal" class="modal">
  <div class="modal-content cart-content" style="max-width:520px;text-align:left;">
    <button class="modal-close" onclick="closeCart()">Ã—</button>
    <h2>Your Cart</h2>
    <div id="cartItems" style="margin:12px 0;"></div>
    <hr class="cart-divider" style="margin:12px 0;">

    <h4 style="margin:6px 0 4px 0;color:#111;">Shipping Details</h4>
    <div class="shipping-options" style="margin-bottom:10px;">
      <label><input type="radio" name="shipping" value="7"> 7â‚¬ â€” No tracked</label><br>
      <label><input type="radio" name="shipping" value="10"> 10â‚¬ â€” Tracked</label>
    </div>

    <div class="cart-total">
      <span>Total:</span>
      <span id="cartTotal">â‚¬ --</span>
    </div>
    <button class="btn cart-checkout">Checkout</button>
  </div>
</div>

<script>
/* ===== Menu open/close ===== */
const openBtn = document.getElementById('openMenu');
const closeBtn = document.getElementById('closeMenu');
const drawer = document.getElementById('sideMenu');
const overlay = document.getElementById('drawerOverlay');
function openDrawer(){
  drawer.classList.add('open');
  overlay.classList.add('show');
  openBtn.setAttribute('aria-expanded','true');
  drawer.setAttribute('aria-hidden','false');
  // body ganha classe para jogar o carrinho para trÃ¡s
  document.body.classList.add('menu-open');
}
function closeDrawer(){
  drawer.classList.remove('open');
  overlay.classList.remove('show');
  openBtn.setAttribute('aria-expanded','false');
  drawer.setAttribute('aria-hidden','true');
  // remove a classe quando fechar
  document.body.classList.remove('menu-open');
}
openBtn.addEventListener('click', openDrawer);
closeBtn.addEventListener('click', closeDrawer);
overlay.addEventListener('click', closeDrawer);
document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') { closeDrawer(); closeProductModal(); } });

const PUBLIC_JSON = './products.json';
const grid = document.getElementById('products');
let currentList = [];

function fmtEUR(n){
  const v = Number(n);
  if(Number.isNaN(v)) return 'â‚¬ ' + (n ?? '');
  if(Number.isInteger(v)) return 'â‚¬ ' + v;
  return 'â‚¬ ' + String(v);
}
function sanitizeList(list){
  if(!Array.isArray(list)) return [];
  return list.map(p => ({
    id: p.id || (crypto.randomUUID ? crypto.randomUUID() : Math.floor(Math.random()*1e9)),
    title: p.title || '',
    brand: p.brand || '',
    price: Number(p.price || 0),
    image: p.image || '5.png',
    description: p.description || '',
    gallery: Array.isArray(p.gallery)? p.gallery : [],
    category: p.category || '',
    createdAt: p.createdAt || 0,
    stock: typeof p.stock === 'number' ? p.stock : parseInt(p.stock || '0', 10)
  }));
}
async function readPublic(){
  try{
    const r = await fetch(PUBLIC_JSON + '?t=' + Date.now(), {cache:'no-store'});
    if(!r.ok) throw new Error('HTTP '+r.status);
    const data = await r.json();
    return sanitizeList(data);
  }catch(e){ return []; }
}

/* ===== RENDER ===== */
function render(list){
  grid.innerHTML = '';
  if(!list.length){
    grid.innerHTML = '<div class="meta" style="text-align:center;padding:20px;">No products available.</div>';
    return;
  }
  list.forEach(p=>{
    const el = document.createElement('article'); el.className='product';
    if(Number(p.stock) <= 0){
      const badge = document.createElement('div'); badge.className = 'oos-ribbon'; badge.textContent = 'OUT OF STOCK'; el.appendChild(badge);
    }
    const img = document.createElement('img'); img.src = p.image; img.alt = p.title; img.loading="lazy";
    img.dataset.action='open-product'; img.dataset.id=p.id;
    el.appendChild(img);

    const body = document.createElement('div'); body.className='product-body';
    const brand = p.brand ? `<div class="meta">${p.brand}</div>` : '';
    const h3 = document.createElement('h3'); h3.textContent = p.title; h3.dataset.action='open-product'; h3.dataset.id=p.id;
    body.appendChild(h3);
    if(brand){ const div = document.createElement('div'); div.className='meta'; div.textContent = p.brand; body.appendChild(div); }
    const stock = document.createElement('div'); stock.className='meta'; stock.textContent = 'Stock: ' + p.stock; body.appendChild(stock);
    const price = document.createElement('div'); price.className='price'; price.textContent = fmtEUR(p.price); body.appendChild(price);
    el.appendChild(body);

    const cta = document.createElement('div'); cta.className='cta';
    const a = document.createElement('a');
    a.className='btn'; a.href='#'; a.textContent = Number(p.stock) > 0 ? "Add to Cart" : "Out of Stock";
    if(Number(p.stock) > 0){ a.dataset.action = 'add-to-cart'; a.dataset.id = p.id; } else { a.classList.add('disabled'); }
    cta.appendChild(a); el.appendChild(cta); grid.appendChild(el);
  });
}
function searchProducts(){
  const term = document.getElementById('search').value.toLowerCase();
  const filtered = currentList.filter(p =>
    p.title.toLowerCase().includes(term) ||
    (p.brand && p.brand.toLowerCase().includes(term)) ||
    (p.category && p.category.toLowerCase().includes(term))
  );
  render(filtered);
}

/* ===== Product Modal logic ===== */
const productModal = document.getElementById('productModal');
const pmTitle = document.getElementById('pmTitle');
const pmBrand = document.getElementById('pmBrand');
const pmPrice = document.getElementById('pmPrice');
const pmStock = document.getElementById('pmStock');
const pmDesc = document.getElementById('pmDesc');
const pmImage = document.getElementById('pmImage');
const pmGallery = document.getElementById('pmGallery');
const pmCta = document.getElementById('pmCta');

function openProductModal(product){
  if(!product) return;
  pmTitle.textContent = product.title || '';
  pmBrand.textContent = product.brand ? product.brand : '';
  pmPrice.textContent = fmtEUR(product.price);
  pmStock.textContent = 'Stock: ' + (product.stock ?? 0);
  pmDesc.textContent = product.description || 'â€”';

  pmImage.src = product.image;
  pmImage.alt = product.title || 'Product image';

  pmGallery.innerHTML = '';
  const gallery = Array.isArray(product.gallery) ? product.gallery : [];
  const images = [product.image, ...gallery.filter(Boolean)];
  images.slice(0,8).forEach(src => {
    const gi = document.createElement('img');
    gi.src = src;
    gi.alt = product.title;
    gi.addEventListener('click', ()=>{ pmImage.src = src; });
    pmGallery.appendChild(gi);
  });

  pmCta.innerHTML = '';
  const btn = document.createElement('a');
  btn.href = '#';
  btn.className = 'btn';
  if(Number(product.stock) > 0){
    btn.textContent = 'Add to Cart';
    btn.dataset.action = 'add-to-cart';
    btn.dataset.id = product.id;
  }else{
    btn.textContent = 'Out of Stock';
    btn.classList.add('disabled');
  }
  pmCta.appendChild(btn);

  productModal.style.display = 'flex';
  productModal.setAttribute('aria-hidden','false');
}
function closeProductModal(){
  productModal.style.display = 'none';
  productModal.setAttribute('aria-hidden','true');
}

/* Open on click (image or title) */
document.addEventListener('click', function(e){
  const openBtn = e.target.closest('[data-action="open-product"]');
  if(openBtn){
    e.preventDefault();
    const id = openBtn.dataset.id;
    const product = currentList.find(p => String(p.id) === String(id));
    openProductModal(product);
    return;
  }
  const addBtn = e.target.closest('[data-action="add-to-cart"]');
  if(addBtn){
    e.preventDefault();
    const id = addBtn.dataset.id;
    if(id){ addToCart(id); }
    return;
  }
});
productModal.addEventListener('click', (e)=>{
  if(e.target === productModal){ closeProductModal(); }
});

/* ===== Cart ===== */
const CART_KEY='hs_cart';
function loadCart(){ try{ return JSON.parse(localStorage.getItem(CART_KEY)||'[]'); }catch(e){ return []; } }
function saveCart(c){ localStorage.setItem(CART_KEY, JSON.stringify(c)); }
let cart = loadCart();
function addToCart(productId){
  const product = currentList.find(p => String(p.id) === String(productId));
  if(!product) return;
  const existing = cart.find(item => item.id === product.id);
  if(existing){ existing.qty++; } else { cart.push({...product, qty: 1}); }
  saveCart(cart);
  updateCartIcon();
}
function updateCartIcon(){
  const countEl = document.getElementById('cartCount');
  const totalItems = cart.reduce((sum, item) => sum + item.qty, 0);
  countEl.textContent = totalItems ? String(totalItems) : '';
}
function getSelectedShipping(){
  return document.querySelector('input[name="shipping"]:checked');
}
function openCart(){
  const cartModal = document.getElementById('cartModal');
  const list = document.getElementById('cartItems');
  const totalEl = document.getElementById('cartTotal');
  list.innerHTML = '';
  if(cart.length === 0){
    list.innerHTML = '<p style="color:#666">Your cart is empty.</p>';
    totalEl.textContent = 'â‚¬ 0.00';
  } else {
    let total = 0;
    cart.forEach(item => {
      total += Number(item.price) * item.qty;
      const row = document.createElement('div');
      row.className = 'cart-item';
      row.innerHTML = `
        <div class="cart-item-left">
          <img class="cart-thumb" src="${item.image}" alt="${item.title}">
          <div>
            <strong>${item.title}</strong><br>
            <small>${fmtEUR(item.price)}</small>
          </div>
        </div>
        <div class="cart-qty">
          <button onclick="changeQty('${item.id}', -1)" style="padding:4px 8px;">âˆ’</button>
          <span>${item.qty}</span>
          <button onclick="changeQty('${item.id}', 1)" style="padding:4px 8px;">+</button>
        </div>
      `;
      list.appendChild(row);
    });
    const selected = getSelectedShipping();
    const shipping = selected ? Number(selected.value) : 0;
    totalEl.textContent = fmtEUR(total + shipping);
  }
  cartModal.style.display = 'flex';
}
function closeCart(){ document.getElementById('cartModal').style.display = 'none'; }
function changeQty(id, delta){
  const item = cart.find(p => p.id === id);
  if(!item) return;
  item.qty += delta;
  if(item.qty <= 0){ cart = cart.filter(p => p.id !== id); }
  saveCart(cart);
  openCart();
  updateCartIcon();
}
document.addEventListener('DOMContentLoaded', () => {
  const radios = document.querySelectorAll('input[name="shipping"]');
  const totalEl = document.getElementById('cartTotal');
  const checkoutBtn = document.querySelector('.cart-checkout');
  function calcBaseTotal() {
    return cart.reduce((sum, item) => sum + Number(item.price) * item.qty, 0);
  }
  function updateDisplayTotal() {
    const base = calcBaseTotal();
    const sel = document.querySelector('input[name="shipping"]:checked');
    const shippingVal = sel ? Number(sel.value) : 0;
    totalEl.textContent = fmtEUR(base + shippingVal);
  }
  radios.forEach(r => r.addEventListener('change', updateDisplayTotal));
  const _openCart = openCart;
  openCart = function() {
    _openCart();
    updateDisplayTotal();
  };
  checkoutBtn.addEventListener('click', () => {
    const sel = getSelectedShipping();
    if(!sel){
      alert('Please choose a shipping option before continuing.');
      document.getElementById('cartModal').style.display = 'flex';
      return;
    }
    const shipping = Number(sel.value);
    const shippingLabel = shipping === 10 ? 'Tracked (â‚¬10)' : 'No tracked (â‚¬7)';
    localStorage.setItem('hs_shipping', JSON.stringify({ amount: shipping, label: shippingLabel, ts: Date.now() }));
    window.location.href = 'checkout.html';
  });
});

/* ===== Init ===== */
(async function init(){
  currentList = await readPublic();
  currentList.sort((a,b)=> (b.createdAt||0) - (a.createdAt||0));
  render(currentList);
  document.getElementById('year').textContent = new Date().getFullYear();
  updateCartIcon();
})();
</script>

<script>
// ===== Collapsible submenus (Suplementes & Cosmetics) =====
(function(){
  // Ensure all submenus start hidden
  document.addEventListener('DOMContentLoaded', function(){
    document.querySelectorAll('.submenu').forEach(function(ul){
      ul.hidden = true;
    });
  });

  // Toggle only when caret is clicked
  document.addEventListener('click', function(e){
    var toggle = e.target.closest('.submenu-toggle');
    if(!toggle) return;
    e.preventDefault();
    e.stopPropagation();
    var expanded = toggle.getAttribute('aria-expanded') === 'true';
    toggle.setAttribute('aria-expanded', String(!expanded));
    var submenuId = toggle.getAttribute('aria-controls');
    var submenu = document.getElementById(submenuId);
    if(!submenu) return;
    submenu.hidden = expanded; // if it was open, hide; else show
  }, true);
})();
</script>

</body>
</html>