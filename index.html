<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>HS Nutrition | Supplements Store</title>
<link href="https://fonts.googleapis.com" rel="preconnect"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet"/>
<meta content="no-store" http-equiv="Cache-Control"/>
<style>
:root{
  --black:#0d0d0d;
  --white:#ffffff;
  --muted:#9c9c9c;
  --orange:#ff3c00;
  --card:#1a1a1a;
  --oos:#ff2d2d;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Poppins,system-ui,Arial,sans-serif;
  color:var(--white);
  background: var(--black);
  min-height:100dvh;
}
.wrap{max-width:1200px;margin:0 auto;padding:26px}
.card{
  background:var(--card);
  border-radius:20px;
  padding:10px 22px 28px;
  border:1px solid rgba(255,255,255,.1);
  box-shadow:0 18px 42px rgba(0,0,0,.6);
  position:relative;
}
header{text-align:center;margin-bottom:18px}
.brand{
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:0;
  position:relative;
}
.brand img{
  max-width:100%;
  height:auto;
  border:2px solid var(--orange);
  border-radius:20px;
  animation: glow 3s ease-in-out infinite alternate;
}
@keyframes glow {
  from { box-shadow:0 0 6px rgba(255,60,0,0.3); }
  to   { box-shadow:0 0 14px rgba(255,100,0,0.6); }
}

/* Texto WELCOME animado */
.welcome { width: 100%; max-width: 550px; margin: 10px 0 0 0; }
.welcome text { font-family: "Poppins", cursive; font-size: 64px; fill: none; stroke: var(--orange); stroke-width: 2px; stroke-dasharray: 800; stroke-dashoffset: 800; animation: draw 6s ease forwards; }
@keyframes draw { to { stroke-dashoffset: 0; } }

/* SEARCH BAR */
.brand .search-box {
  position: absolute; bottom: 10px; right: 20px; max-width: 300px; display: flex; gap: 6px;
}
.search-box input { flex: 1; padding: 12px 16px; border-radius: 20px; border: none; outline: none; background: #fff; color: #333; font-size: 14px; }
.search-box input::placeholder { color: #999; }
.search-box button { padding: 12px 20px; border: none; border-radius: 20px; background: #000; color: #fff; font-weight: 600; cursor: pointer; }
.search-box button:hover { filter: brightness(1.2); }

/* CATEGORY BUTTONS */
.category-buttons{ display:flex; justify-content:center; gap:12px; margin: 12px 0 2px; flex-wrap: wrap; }
.pill-btn{
  display:inline-flex; align-items:center; gap:8px; padding:12px 20px; border-radius: 9999px;
  background: var(--orange); color: var(--white); font-weight: 800; border: 2px solid var(--orange);
  text-decoration:none; box-shadow: 0 6px 18px rgba(255,60,0,0.35); cursor:pointer;
  transition: transform .18s ease, filter .18s ease;
}
.pill-btn:hover{ transform: translateY(-1px); filter: brightness(1.05); }
.pill-btn:active{ transform: translateY(0); }

/* Responsivo */
@media (max-width: 600px) {
  .brand { align-items: center; }
  .brand .search-box { position: static; margin-top: 14px; width: 100%; max-width: 100%; padding: 0 10px; display: flex; justify-content: center; gap: 8px; }
  .search-box input { flex: 1; max-width: 70%; padding: 12px; font-size: 16px; }
  .search-box button { padding: 12px 18px; font-size: 15px; }
}

.divider{height:2px;background:linear-gradient(90deg,transparent,var(--orange),transparent);margin:18px 0}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:22px;align-items:stretch}
.product{background:#111;border:1px solid rgba(255,255,255,.08);border-radius:18px;overflow:hidden;box-shadow:0 10px 28px rgba(0,0,0,.28);display:flex;flex-direction:column; position:relative;}
.product img{width:100%;aspect-ratio:1/1;object-fit:cover;background:#0b0b0b;display:block}
.product-body{padding:14px 16px 10px}
.product h3{margin:0 0 6px;font-weight:700;font-size:16px;color:var(--white);cursor:pointer;text-decoration:underline dotted transparent}
.product h3:hover{text-decoration-color:rgba(255,255,255,.5)}
.meta{color:var(--muted);font-size:13px;line-height:1.4;margin-bottom:8px}
.price{font-weight:700;color:var(--white);margin-bottom:6px}
.cta{padding:12px 14px 14px;border-top:1px dashed rgba(255,255,255,.08)}
.btn{display:block;width:100%;text-align:center;text-decoration:none;font-weight:700;padding:12px 14px;border-radius:28px;background:linear-gradient(90deg,var(--orange), #ff8c42);color:#fff;box-shadow:0 8px 20px rgba(240,116,36,.35);transition:transform .18s ease, filter .18s ease;}
.btn:hover{transform:translateY(-1px);filter:brightness(1.1)}
.btn.disabled{opacity:.55;pointer-events:none;filter:grayscale(1)}

footer{color:var(--muted);text-align:center;font-size:12px;margin-top:20px}

.admin-btn-modal { position: absolute; top: 12px; right: 12px; z-index: 100; }
.admin-btn-modal a { background: var(--orange); color: var(--white); text-decoration: none; padding: 4px 8px; border-radius: 6px; font-weight: 500; font-size: 11px; box-shadow: 0 1px 4px rgba(0,0,0,0.4); transition: filter 0.2s; display: inline-block; }
.admin-btn-modal a:hover { filter: brightness(1.1); }

/* OUT OF STOCK ribbon */
.oos-ribbon{
  position:absolute;
  top:10px; left:-40px;
  transform: rotate(-20deg);
  background: rgba(255,45,45,0.85);
  color:#fff;
  padding:10px 60px;
  font-weight:900;
  letter-spacing:.12em;
  text-shadow: 0 1px 2px rgba(0,0,0,.35);
  box-shadow:0 10px 20px rgba(0,0,0,.35);
  border:2px solid rgba(255,255,255,0.12);
  pointer-events:none;
}

/* ===== NEW PRODUCT MODAL (Next-style, HS colors) ===== */
#modal{ position:fixed; inset:0; display:none; place-items:center; z-index:4000; }
#modal.open{ display:grid }
#modal .overlay{ position:absolute; inset:0; background:rgba(0,0,0,.75); backdrop-filter: blur(2px); }
#modal .panel{ position:relative; width:min(96vw,980px); max-height:92vh; overflow:hidden; background:var(--card); color:var(--white); border:2px solid var(--orange); border-radius:18px; box-shadow:0 0 16px rgba(255,60,0,.25), 0 18px 42px rgba(0,0,0,.6); display:grid; grid-template-columns: 1.2fr 1fr; }
@media (max-width:860px){ #modal .panel{ grid-template-columns: 1fr; } }
#modal .gallery{ background:var(--card); padding:10px; display:flex; flex-direction:column; }
#modal .hero-wrap{ position:relative; }
#modal .hero{ width:100%; aspect-ratio:1/1; object-fit:contain; border-radius:12px; background:#0b0b0b }
#thumbs{ display:flex; gap:8px; overflow:auto; padding:10px 0 }
#thumbs img{ width:80px; height:80px; object-fit:cover; border-radius:8px; opacity:.85; cursor:pointer; border:1px solid rgba(255,255,255,.12) }
#thumbs img.active{ opacity:1; outline:2px solid var(--orange) }
#modal .details{ padding:16px; overflow:auto }
#modal h2{ margin:0 0 8px; font-size:20px }
#modal .meta{ margin:8px 0; font-size:13px; color:var(--muted) }
#modal .price{ font-size:18px; margin:8px 0 12px; font-weight:800 }
#modal .desc{ font-size:14px; line-height:1.5; color:#d7d7d7; white-space:pre-wrap }
#modal .actions{ display:flex; gap:8px; margin-top:12px; flex-wrap:wrap }
#modal .btn.secondary{ background:#151515; color:#fff; box-shadow:none }
#modal .close{ position:absolute; top:10px; right:10px; background:#151515; color:#fff; border:0; border-radius:10px; padding:8px 10px; font-weight:700; cursor:pointer }
/* nav & counter */
#modal .nav{ position:absolute; top:50%; transform:translateY(-50%); background:rgba(0,0,0,.45); border:0; color:#fff; font-size:26px; line-height:1; width:40px; height:40px; border-radius:50%; cursor:pointer; display:grid; place-items:center }
#modal .nav:hover{ filter:brightness(1.1) }
#modal .nav.prev{ left:10px }
#modal .nav.next{ right:10px }
#modal .counter{ position:absolute; top:10px; left:10px; background:rgba(0,0,0,.45); padding:4px 8px; border-radius:10px; font-size:12px; color:#fff }

/* MOBILE TWEAKS */
@media (max-width: 600px) {
  #modal .panel { width: 96vw; max-height: calc(100dvh - 20px); border-radius: 14px; overflow: hidden; display: flex; flex-direction: column; }
  #modal .hero { aspect-ratio: 1/1; max-height: 56svh; }
  #modal .nav { z-index: 5; width: clamp(32px, 9vw, 40px); height: clamp(32px, 9vw, 40px); font-size: clamp(20px, 6vw, 26px); }
  #modal .nav.prev { left: min(10px, 2.5vw); }
  #modal .nav.next { right: min(10px, 2.5vw); }
  #modal .details { flex: 1; overflow-y: auto; -webkit-overflow-scrolling: touch; padding: 16px; padding-bottom: calc(env(safe-area-inset-bottom) + 16px); }
  #modal .actions { position: sticky; bottom: 0; padding-top: 10px; padding-bottom: calc(env(safe-area-inset-bottom) + 10px); background: linear-gradient(180deg, rgba(26,26,26,0) 0%, var(--card) 45%); }
  #thumbs img { width: 72px; height: 72px; }
  #modal .close { z-index: 6; }
}

/* Floating cart button */
.floating-cart {
  position: fixed; bottom: 20px; right: 20px; background: var(--orange); color: white; border-radius: 50%;
  width: 60px; height: 60px; display: flex; align-items: center; justify-content: center;
  box-shadow: 0 6px 18px rgba(0,0,0,0.35); cursor: pointer; z-index: 5000; font-size: 28px; transition: transform 0.3s ease;
}
.floating-cart:hover { transform: scale(1.1) rotate(5deg); }

/* Cart modal (kept) */
.modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.85); justify-content:center; align-items:center; z-index:3000; }
.modal-content {
  background:var(--card); padding:20px; border-radius:16px; max-width:600px; width:90%; text-align:left; color:var(--white); position:relative; border: 1px solid rgba(255,255,255,0.12);
}
.modal-close{position:absolute;top:10px;right:10px;background:#ff3c00;border:none;color:#fff;font-weight:bold;padding:6px 12px;border-radius:6px;cursor:pointer}
</style>
</head>
<body>
<div class="wrap">
<div class="card">
<div class="admin-btn-modal"><a href="login.html">Admin</a></div>
<header>
<div class="brand">
<svg class="welcome" viewBox="0 0 600 140" xmlns="http://www.w3.org/2000/svg">
  <text text-anchor="middle" x="50%" y="50%">WELCOME</text>
  <text text-anchor="middle" x="50%" y="72%" style="font-family: Poppins, sans-serif; font-size: 18px; fill: var(--orange); stroke: none;">www.hs-nutrition.ie</text>
</svg>
<img alt="HS Nutrition Cover" src="5.png"/>
<div class="search-box">
  <input id="search" placeholder="Search for products..." type="text"/>
  <button onclick="searchProducts()">Search</button>
</div>
</div>
</header>
<div class="category-buttons">
  <a class="pill-btn" href="supplements.html">Supplements</a>
  <a class="pill-btn" href="cosmetics.html">Cosmetics</a>
</div>
<div class="divider"></div>
<section class="grid" id="products"></section>
<div class="divider"></div>
<footer>© <span id="year"></span> HS Nutrition</footer>
</div>
</div>

<!-- Product Modal -->
<div id="modal" aria-hidden="true" role="dialog">
  <div class="overlay" data-close></div>
  <div class="panel" role="document">
    <button class="close" data-close>&times; Close</button>
    <div class="gallery">
      <div class="hero-wrap">
        <img id="hero" class="hero" alt="Product main photo" src=""/>
        <button class="nav prev" id="gPrev" aria-label="Anterior">‹</button>
        <button class="nav next" id="gNext" aria-label="Próxima">›</button>
        <div class="counter" id="mCount">0/0</div>
      </div>
      <div id="thumbs"></div>
    </div>
    <div class="details">
      <h2 id="mTitle">—</h2>
      <div id="mMeta" class="meta">—</div>
      <div id="mPrice" class="price">—</div>
      <div id="mDesc" class="desc">—</div>
      <div class="actions">
        <a id="mAdd" class="btn" href="#" data-action="add-to-cart">Add to Cart</a>
        <a id="mCloseBtn" class="btn secondary" href="#" data-close>Close</a>
      </div>
    </div>
  </div>
</div>

<script>
const PUBLIC_JSON = './products.json';
const grid = document.getElementById('products');
let currentList = [];

// Modal refs
const modal = document.getElementById('modal');
const hero = document.getElementById('hero');
const thumbs = document.getElementById('thumbs');
const mTitle = document.getElementById('mTitle');
const mMeta = document.getElementById('mMeta');
const mPrice = document.getElementById('mPrice');
const mDesc = document.getElementById('mDesc');
const mAdd  = document.getElementById('mAdd');
const gPrev  = document.getElementById('gPrev');
const gNext  = document.getElementById('gNext');
const mCount = document.getElementById('mCount');

let galleryImgs = [];
let galleryIndex = 0;

const fmtEUR = n => '€ ' + (Number(n||0)).toLocaleString('en-IE', {minimumFractionDigits:2, maximumFractionDigits:2});

function sanitizeList(list){
  if(!Array.isArray(list)) return [];
  return list.map(p => ({
    id: p.id || (crypto.randomUUID ? crypto.randomUUID() : Math.floor(Math.random()*1e9)),
    title: p.title || '',
    brand: p.brand || '',
    price: Number(p.price || 0),
    image: p.image || '5.png',
    description: p.description || '',
    gallery: Array.isArray(p.gallery)? p.gallery : [],
    category: p.category || '',
    createdAt: p.createdAt || 0,
    stock: typeof p.stock === 'number' ? p.stock : parseInt(p.stock || '0', 10)
  }));
}

async function readPublic(){
  try{
    const r = await fetch(PUBLIC_JSON + '?t=' + Date.now(), {cache:'no-store'});
    if(!r.ok) throw new Error('HTTP '+r.status);
    const data = await r.json();
    return sanitizeList(data);
  }catch(e){ return []; }
}

function render(list){
  grid.innerHTML = '';
  if(!list.length){
    grid.innerHTML = '<div class="meta" style="text-align:center;padding:20px;">No products available.</div>';
    return;
  }
  list.forEach(p=>{
    const el = document.createElement('article'); el.className='product';
    if(Number(p.stock) <= 0){
      const badge = document.createElement('div');
      badge.className = 'oos-ribbon';
      badge.textContent = 'OUT OF STOCK';
      el.appendChild(badge);
    }
    const img = document.createElement('img'); img.src = p.image; img.alt = p.title; el.appendChild(img);
    const body = document.createElement('div'); body.className='product-body';
    const brand = p.brand ? `<div class="meta">${p.brand}</div>` : '';
    body.innerHTML = `<h3 onclick="openModal('${p.id}')">${p.title}</h3>${brand}<div class='meta'>Stock: ${p.stock}</div><div class='price'>€ ${p.price}</div>`;
    el.appendChild(body);
    const cta = document.createElement('div'); cta.className='cta';
    const a = document.createElement('a');
    a.className='btn';
    a.href='#';
    a.textContent = Number(p.stock) > 0 ? "Add to Cart" : "Out of Stock";
    if(Number(p.stock) > 0){
      a.dataset.action = 'add-to-cart';
      a.dataset.id = p.id;
    } else {
      a.classList.add('disabled');
    }
    cta.appendChild(a);
    el.appendChild(cta);
    grid.appendChild(el);
  });
}

function searchProducts(){
  const term = document.getElementById('search').value.toLowerCase();
  const filtered = currentList.filter(p =>
    p.title.toLowerCase().includes(term) ||
    (p.brand && p.brand.toLowerCase().includes(term)) ||
    (p.category && p.category.toLowerCase().includes(term))
  );
  render(filtered);
}

/* ===== Modal logic ===== */
function setActiveThumb(i){
  thumbs.querySelectorAll('img').forEach((t,idx)=>{
    if(idx===i) t.classList.add('active'); else t.classList.remove('active');
  });
}
function showImage(i){
  if(!galleryImgs.length) return;
  galleryIndex = (i+galleryImgs.length) % galleryImgs.length;
  hero.src = galleryImgs[galleryIndex];
  setActiveThumb(galleryIndex);
  mCount.textContent = `${galleryIndex+1}/${galleryImgs.length}`;
}

function openModal(id){
  const product = currentList.find(p=>String(p.id)===String(id));
  if(!product) return;

  // Galeria
  galleryImgs = [product.image, ...(product.gallery||[])].filter(Boolean);
  if(!galleryImgs.length) galleryImgs = ['5.png'];
  hero.src = galleryImgs[0];
  hero.alt = product.title || 'Product photo';
  galleryIndex = 0; mCount.textContent = `1/${galleryImgs.length}`;
  thumbs.innerHTML = galleryImgs.map((src,i)=>`<img ${i===0?'class="active"':''} data-idx="${i}" src="${src}" alt="thumb ${i+1}">`).join('');
  thumbs.querySelectorAll('img').forEach(img=> img.addEventListener('click', ()=> showImage(Number(img.dataset.idx)) ));

  // Detalhes
  mTitle.textContent = product.title || '—';
  mMeta.textContent = [product.brand||null, Number(product.stock)>=0?`Stock: ${product.stock}`:null].filter(Boolean).join(' • ');
  mPrice.textContent = product.price?fmtEUR(product.price):'';
  mDesc.textContent = product.description || '';

  // Action (usar mesmo handler do card)
  mAdd.dataset.action = 'add-to-cart';
  mAdd.dataset.id = product.id;

  // Abrir
  modal.classList.add('open');
  modal.setAttribute('aria-hidden','false');
  document.body.style.overflow='hidden';
}
function closeModal(){
  modal.classList.remove('open');
  modal.setAttribute('aria-hidden','true');
  document.body.style.overflow='';
  thumbs.innerHTML='';
}
modal.addEventListener('click', (ev)=>{ if(ev.target.hasAttribute('data-close')) closeModal(); });
window.addEventListener('keydown', (ev)=>{
  if(ev.key==='Escape' && modal.classList.contains('open')) closeModal();
  if(!modal.classList.contains('open')) return;
  if(ev.key==='ArrowRight') showImage(galleryIndex+1);
  if(ev.key==='ArrowLeft')  showImage(galleryIndex-1);
});
document.getElementById('gPrev').addEventListener('click', ()=> showImage(galleryIndex-1));
document.getElementById('gNext').addEventListener('click', ()=> showImage(galleryIndex+1));

(async function init(){
  currentList = await readPublic();
  currentList.sort((a,b)=> (b.createdAt||0) - (a.createdAt||0));
  render(currentList);
  document.getElementById('year').textContent = new Date().getFullYear();
})();
</script>

<div class="floating-cart" onclick="openCart()">🛒</div>

<!-- Cart Modal -->
<div id="cartModal" class="modal">
  <div class="modal-content" style="max-width:500px;text-align:left;">
    <button class="modal-close" onclick="closeCart()">×</button>
    <h2>Your Cart</h2>
    <div id="cartItems" style="margin:12px 0;"></div>
    <hr style="border:none;border-top:1px solid rgba(255,255,255,0.1);margin:12px 0;">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
      <strong>Total Amount:</strong>
      <strong id="cartTotal">€ 0.00</strong>
    </div>
    <button class="btn" style="width:100%;background:#28a745;">Checkout</button>
  </div>
</div>

<script>
let cart = [];

function addToCart(productId){
  const product = currentList.find(p => String(p.id) === String(productId));
  if(!product) return;
  const existing = cart.find(item => item.id === product.id);
  if(existing){ existing.qty++; } else { cart.push({...product, qty: 1}); }
  updateCartIcon();
}

function updateCartIcon(){
  const cartBtn = document.querySelector('.floating-cart');
  const totalItems = cart.reduce((sum, item) => sum + item.qty, 0);
  cartBtn.innerHTML = `🛒${totalItems ? ' ('+totalItems+')' : ''}`;
}

function openCart(){
  const cartModal = document.getElementById('cartModal');
  const list = document.getElementById('cartItems');
  const totalEl = document.getElementById('cartTotal');
  list.innerHTML = '';
  if(cart.length === 0){
    list.innerHTML = '<p style="color:var(--muted)">Your cart is empty.</p>';
    totalEl.textContent = '€ 0.00';
  } else {
    let total = 0;
    cart.forEach(item => {
      total += item.price * item.qty;
      const row = document.createElement('div');
      row.style.display = 'flex';
      row.style.justifyContent = 'space-between';
      row.style.alignItems = 'center';
      row.style.marginBottom = '10px';
      row.innerHTML = `
        <div><strong>${item.title}</strong><br><small>€ ${Number(item.price).toFixed(2)}</small></div>
        <div style="display:flex;align-items:center;gap:6px;">
          <button onclick="changeQty('${item.id}', -1)" style="padding:4px 8px;">−</button>
          <span>${item.qty}</span>
          <button onclick="changeQty('${item.id}', 1)" style="padding:4px 8px;">+</button>
        </div>
      `;
      list.appendChild(row);
    });
    totalEl.textContent = '€ ' + total.toFixed(2);
  }
  cartModal.style.display = 'flex';
}

function closeCart(){ document.getElementById('cartModal').style.display = 'none'; }

function changeQty(id, delta){
  const item = cart.find(p => p.id === id);
  if(!item) return;
  item.qty += delta;
  if(item.qty <= 0){ cart = cart.filter(p => p.id !== id); }
  openCart();
  updateCartIcon();
}

/* ===== Unified click handler for Add-to-Cart ===== */
document.addEventListener('click', function(e){
  const btn = e.target.closest('[data-action="add-to-cart"]');
  if(!btn) return;
  e.preventDefault();
  const id = btn.dataset.id;
  if(id){ addToCart(id); }
});
</script>

</body>
</html>
