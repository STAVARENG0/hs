<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Checkout | HS Nutrition</title>
<!-- No favicon -->
<link rel="icon" href="data:,">
<link rel="shortcut icon" href="data:,">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
<style>
:root { --orange:#ff3c00; --white:#ffffff; --bg:#f5f6fa; --text:#222; }
*{ box-sizing:border-box; margin:0; padding:0; font-family:'Poppins',sans-serif; }
body{ background:var(--bg); color:var(--text); display:flex; justify-content:center; align-items:center; min-height:100vh; padding:20px; }
.checkout-card{ background:var(--white); border-radius:20px; box-shadow:0 10px 30px rgba(0,0,0,.12); max-width:620px; width:100%; padding:32px 26px; text-align:center; }
.logo{ width:180px; border-radius:16px; border:2px solid var(--orange); box-shadow:0 0 12px rgba(255,60,0,.35); margin-bottom:18px; }
h1{ color:var(--orange); font-size:22px; margin-bottom:14px; }
.cart-items{ text-align:left; margin:20px 0; }
.cart-item{ display:flex; justify-content:space-between; align-items:center; margin-bottom:8px; }
.cart-item span{ font-size:14px; }
.cart-item strong{ color:var(--orange); }
.total{ font-size:20px; font-weight:700; color:var(--orange); margin:20px 0; text-align:right; }
#paypal-buttons{ margin-top:16px; }
#paypal-button-paypal, #paypal-button-card{ margin-bottom:12px; }
footer{ margin-top:16px; color:#666; font-size:13px; }
</style>
</head>
<body>

<div class="checkout-card">
  <img src="5.png" alt="HS Nutrition" class="logo">
  <h1>Your Cart</h1>
  <div class="cart-items" id="cartList"></div>
  <div class="total">Total: € <span id="totalAmount">0.00</span></div>

  <div id="paypal-buttons">
    <div id="paypal-button-paypal"></div>
    <div id="paypal-button-card"></div>
  </div>

  <footer>© <span id="year"></span> HS Nutrition</footer>
</div>

<!-- PayPal SDK (buttons + card) -->
<script src="https://www.paypal.com/sdk/js?client-id=ATM-JsB9g4-G3NnRT-Mzln_I-H3eHtJI9wGF-nbGVaakZ-4ql0Z8CSSEjzOdBmITrY-Cy2cxJIo-ffNB&currency=EUR&intent=capture&commit=true&locale=en_IE&components=buttons,funding-eligibility&enable-funding=card"></script>
<script>
const CART_KEY='hs_cart';
function fmtEUR(n){ return '€ ' + Number(n).toFixed(2); }
document.getElementById('year').textContent = new Date().getFullYear();

let cart=[]; try{ cart = JSON.parse(localStorage.getItem(CART_KEY)||'[]'); }catch(e){ cart=[]; }

function renderCart(){
  const list = document.getElementById('cartList');
  let total = 0;
  if(!cart.length){
    list.innerHTML = '<p style="color:#666;text-align:center;">Your cart is empty.</p>';
  }else{
    list.innerHTML = cart.map(item=>{
      const qty = Number(item.qty)||0;
      const price = Number(item.price)||0;
      const subtotal = qty*price; total += subtotal;
      return `<div class="cart-item">
                <span>${qty}× ${item.title}</span>
                <strong>${fmtEUR(subtotal)}</strong>
              </div>`;
    }).join('');
  }
  document.getElementById('totalAmount').textContent = total.toFixed(2);
  return total;
}
renderCart();

function commonConfig(){
  return {
    onClick: function(data, actions){
      const t = renderCart();
      if(t <= 0){ alert('Your cart is empty. Please add products before paying.'); return actions.reject(); }
      return actions.resolve();
    },
    createOrder: function(data, actions){
      const t = renderCart();
      return actions.order.create({
        purchase_units:[{ amount:{ value:t.toFixed(2), currency_code:'EUR' }, description:'HS Nutrition Order' }]
      });
    },
    onApprove: function(data, actions){
      return actions.order.capture().then(function(details){
        alert('✅ Payment completed by ' + (details?.payer?.name?.given_name || 'customer') + '!');
        localStorage.removeItem(CART_KEY);
        document.getElementById('cartList').innerHTML = '<p style="color:green;text-align:center;">Payment Approved!</p>';
        document.getElementById('totalAmount').textContent = '0.00';
        document.getElementById('paypal-buttons').innerHTML = '';
      });
    },
    onError: function(err){ console.error('PayPal error:', err); alert('❌ There was an issue with PayPal Checkout. Please try again.'); }
  };
}

if(typeof paypal !== 'undefined'){
  // 1) Only PayPal (yellow)
  const btnPayPal = paypal.Buttons(Object.assign({}, commonConfig(), {
    fundingSource: paypal.FUNDING.PAYPAL,
    style:{ layout:'vertical', color:'gold', shape:'pill', label:'paypal', height:45 }
  }));
  if(btnPayPal.isEligible()) btnPayPal.render('#paypal-button-paypal');

  // 2) Only Card (black)
  const btnCard = paypal.Buttons(Object.assign({}, commonConfig(), {
    fundingSource: paypal.FUNDING.CARD,
    style:{ layout:'vertical', color:'black', shape:'pill', label:'pay', height:45 }
  }));
  if(btnCard.isEligible()) btnCard.render('#paypal-button-card');
}
</script>

</body>
</html>